---
title: Sistema de GestiÃ³n de Inventario - Arquitectura Empresarial
---
graph TB
    %% ============================================
    %% CAPA DE USUARIOS Y CLIENTES
    %% ============================================
    subgraph USERS["ğŸ‘¥ USUARIOS"]
        WEB["ğŸŒ AplicaciÃ³n Web<br/>Dashboard de GestiÃ³n"]
        MOBILE["ğŸ“± App MÃ³vil<br/>Ventas en Tienda"]
        API_CLIENT["ğŸ”Œ Sistemas Externos<br/>ERP, Ecommerce"]
    end

    %% ============================================
    %% CAPA DE API (PUNTO DE ENTRADA)
    %% ============================================
    subgraph API["ğŸšª API REST"]
        GATEWAY["Puerto 8080<br/>Seguridad con API Keys<br/>Rate Limiting"]
    end

    %% ============================================
    %% FUNCIONALIDADES DE NEGOCIO
    %% ============================================
    subgraph BUSINESS["ğŸ’¼ FUNCIONALIDADES DE NEGOCIO"]
        direction TB
        
        subgraph PRODUCTS["ğŸ“¦ GestiÃ³n de Productos"]
            PROD_CREATE["âœ¨ Crear Productos"]
            PROD_UPDATE["âœï¸ Actualizar Info"]
            PROD_SEARCH["ğŸ” BÃºsqueda por SKU"]
        end
        
        subgraph INVENTORY["ğŸ“Š Control de Inventario"]
            INV_UPDATE["ğŸ“ˆ Actualizar Stock<br/><i>Previene Overselling</i>"]
            INV_TRANSFER["ğŸ”„ Transferir entre Tiendas<br/><i>OptimizaciÃ³n LogÃ­stica</i>"]
            INV_CHECK["âœ“ Verificar Disponibilidad<br/><i>Consulta en Tiempo Real</i>"]
        end
        
        subgraph RESERVATIONS["ğŸ« Sistema de Reservas"]
            RES_CREATE["ğŸ”’ Reservar Stock<br/><i>Bloqueo Temporal</i>"]
            RES_CONFIRM["âœ… Confirmar Venta<br/><i>Completar TransacciÃ³n</i>"]
            RES_CANCEL["âŒ Cancelar/Liberar<br/><i>Devolver al Inventario</i>"]
            RES_AUTO["â° Auto-ExpiraciÃ³n<br/><i>LiberaciÃ³n AutomÃ¡tica TTL</i>"]
        end
    end

    %% ============================================
    %% SISTEMA DE EVENTOS (CORAZÃ“N DEL SISTEMA)
    %% ============================================
    subgraph EVENTS["ğŸ“¡ SISTEMA DE EVENTOS EN TIEMPO REAL"]
        direction LR
        
        EVENT_BUS["ğŸš€ Bus de Eventos<br/><b>Redis Streams</b><br/><i>100k eventos/stream</i>"]
        
        subgraph EVENT_TYPES["Tipos de Eventos Publicados"]
            E1["stock.created<br/>stock.updated<br/>stock.transferred"]
            E2["reservation.created<br/>reservation.confirmed<br/>reservation.cancelled"]
        end
        
        RESILIENCE["ğŸ›¡ï¸ MECANISMO DE RESILIENCIA<br/><b>Re-intentos AutomÃ¡ticos</b><br/>âœ“ Sin pÃ©rdida de datos<br/>âœ“ Retry cada 10s si falla<br/>âœ“ AuditorÃ­a completa"]
    end

    %% ============================================
    %% BASE DE DATOS
    %% ============================================
    subgraph DATA["ğŸ’¾ ALMACENAMIENTO PERSISTENTE"]
        DB[("ğŸ“š Base de Datos SQLite<br/><b>inventory.db</b><br/>â”â”â”â”â”â”â”â”â”â”â”â”<br/>âœ“ Productos<br/>âœ“ Stock por Tienda<br/>âœ“ Reservas Activas<br/>âœ“ Historial de Eventos")]
    end

    %% ============================================
    %% PROCESOS AUTOMÃTICOS
    %% ============================================
    subgraph WORKERS["âš™ï¸ PROCESOS AUTOMÃTICOS EN SEGUNDO PLANO"]
        direction TB
        
        WORKER1["â° <b>Monitor de ExpiraciÃ³n</b><br/>Ejecuta: Cada 1 minuto<br/>â”â”â”â”â”â”â”â”â”â”â”â”<br/>Cancela reservas vencidas<br/>Libera stock automÃ¡ticamente<br/>Publica eventos de expiraciÃ³n"]
        
        WORKER2["ğŸ”„ <b>Sistema de RecuperaciÃ³n</b><br/>Ejecuta: Cada 10 segundos<br/>â”â”â”â”â”â”â”â”â”â”â”â”<br/>Re-intenta eventos fallidos<br/>Garantiza entrega eventual<br/>Monitorea salud del sistema"]
    end

    %% ============================================
    %% CARACTERÃSTICAS TÃ‰CNICAS
    %% ============================================
    subgraph FEATURES["âš¡ CARACTERÃSTICAS TÃ‰CNICAS CLAVE"]
        direction LR
        
        F1["ğŸ” Optimistic Locking<br/><i>Previene condiciones de carrera</i><br/><i>MÃºltiples usuarios simultÃ¡neos</i>"]
        F2["ğŸ“ Event Sourcing<br/><i>AuditorÃ­a completa de cambios</i><br/><i>Trazabilidad total</i>"]
        F3["ğŸ¯ Arquitectura Desacoplada<br/><i>Cambiar Redis por Kafka</i><br/><i>Sin modificar cÃ³digo de negocio</i>"]
    end

    %% ============================================
    %% CONSUMIDORES DE EVENTOS (FUTURO)
    %% ============================================
    subgraph CONSUMERS["ğŸ”Œ SISTEMAS QUE PUEDEN CONSUMIR EVENTOS"]
        direction TB
        
        C1["ğŸ“Š <b>Dashboard AnalÃ­tico</b><br/>Reportes en tiempo real<br/>KPIs de negocio"]
        C2["ğŸ“§ <b>Sistema de Notificaciones</b><br/>Alertas de stock bajo<br/>Confirmaciones de venta"]
        C3["ğŸ”— <b>IntegraciÃ³n ERP</b><br/>SincronizaciÃ³n automÃ¡tica<br/>Contabilidad en tiempo real"]
    end

    %% ============================================
    %% CONEXIONES PRINCIPALES
    %% ============================================
    
    %% Usuarios a API
    WEB --> GATEWAY
    MOBILE --> GATEWAY
    API_CLIENT --> GATEWAY
    
    %% API a Funcionalidades
    GATEWAY --> PRODUCTS
    GATEWAY --> INVENTORY
    GATEWAY --> RESERVATIONS
    
    %% Funcionalidades a Base de Datos
    PRODUCTS --> DATA
    INVENTORY --> DATA
    RESERVATIONS --> DATA
    
    %% Funcionalidades a Sistema de Eventos
    INVENTORY -->|"Publica eventos<br/>en tiempo real"| EVENT_BUS
    RESERVATIONS -->|"Publica eventos<br/>en tiempo real"| EVENT_BUS
    
    %% Sistema de Eventos
    EVENT_BUS --> EVENT_TYPES
    EVENT_BUS <--> RESILIENCE
    
    %% Resiliencia a BD (para retry)
    RESILIENCE <-->|"Consulta eventos<br/>pendientes"| DATA
    
    %% Workers
    WORKER1 -->|"Monitorea"| RESERVATIONS
    WORKER1 -->|"Publica eventos"| EVENT_BUS
    
    WORKER2 -->|"Re-intenta"| RESILIENCE
    WORKER2 -->|"Lee pendientes"| DATA
    
    %% Consumidores de Eventos
    EVENT_BUS -.->|"Stream de eventos"| CONSUMERS
    
    %% CaracterÃ­sticas tÃ©cnicas vinculadas
    INVENTORY -.-> F1
    DATA -.-> F2
    EVENT_BUS -.-> F3

    %% ============================================
    %% ESTILOS Y COLORES
    %% ============================================
    
    classDef userLayer fill:#E3F2FD,stroke:#1976D2,stroke-width:3px,color:#000
    classDef apiLayer fill:#F3E5F5,stroke:#7B1FA2,stroke-width:3px,color:#000
    classDef businessLayer fill:#E8F5E9,stroke:#388E3C,stroke-width:3px,color:#000
    classDef eventLayer fill:#FFF3E0,stroke:#F57C00,stroke-width:3px,color:#000
    classDef dataLayer fill:#FCE4EC,stroke:#C2185B,stroke-width:3px,color:#000
    classDef workerLayer fill:#FFEBEE,stroke:#D32F2F,stroke-width:3px,color:#000
    classDef featureLayer fill:#E0F2F1,stroke:#00796B,stroke-width:2px,color:#000
    classDef consumerLayer fill:#F1F8E9,stroke:#689F38,stroke-width:2px,color:#000,stroke-dasharray: 5 5
    classDef resilience fill:#FF6B6B,stroke:#C92A2A,stroke-width:4px,color:#fff
    
    class WEB,MOBILE,API_CLIENT userLayer
    class GATEWAY apiLayer
    class PRODUCTS,INVENTORY,RESERVATIONS,PROD_CREATE,PROD_UPDATE,PROD_SEARCH,INV_UPDATE,INV_TRANSFER,INV_CHECK,RES_CREATE,RES_CONFIRM,RES_CANCEL,RES_AUTO businessLayer
    class EVENT_BUS,EVENT_TYPES,E1,E2 eventLayer
    class DB dataLayer
    class WORKER1,WORKER2 workerLayer
    class F1,F2,F3 featureLayer
    class C1,C2,C3 consumerLayer
    class RESILIENCE resilience

